# Механизм комиссий

Версия `gas` на zkSync называется `ergs` и отражает не только стоимость вычислений, но и стоимость публикации данных в сеть и влияние на хранилище. Подобно `газу`, `ergs` - абсолютная единица. Операции с виртуальной машиной (`add`, `mul`, и т.д.) тоже будут иметь свою стоимость, измеряемую в `ergs`, и они могут не быть равны друг другу. Актуальную таблицу стоимости операций в `ergs` еще предстоит определить.

Поскольку затраты на публикацию данных о вызовах (`calldata`) на L1 очень нестабильны, количество `ergs`, необходимых для изменения слота для хранения данных, не является постоянным. Для каждого блока оператор определяет следующие динамические параметры:

* `ergs_price` — таблица текущей базовой цены в каждом токене. Значение этого параметра используется для определения затрат на выполнение виртуальной машины в каждом токене.
* `ergs_per_pubdata` — цена в `ergs` за публикацию одного байта данных на Ethereum.

**Обратите внимание, что публичные данные публикуются только при изменении состояния.** Если один и тот же слот хранилища обновляется 10 раз в одном и том же блоке rollup'a, то только последнее обновление будет опубликовано на Эфириуме, таким образом, плата за публикацию данных взимается только один раз.

### Зачем нужна иная комиссионная модель? <a href="#why-do-we-need-a-different-fee-model" id="why-do-we-need-a-different-fee-model"></a>

* **Почему `ergs`, а не газ?**

Мы хотим показать четкую разницу между нашей и Эфириумовской комиссионными моделями. Также, в отличие от Эфириума, где большинство опкодов (код операции) имеют совершенно разные цены в газе, основные опкоды zkEVM, вероятно, будут иметь очень схожую стоимость в `ergs`. Как правило, само исполнение (арифметическмие операции, который не требуют обновления хранилища) очень дешевы. Как и в Эфириуме, основной расход - изменение в хранилище данных.

* **Почему не может быть постоянной цены за хранение?**

В качестве элемента модели безопасности zkRollup zkSync периодически публикует изменения состояния в Эфириум L1. Стоимость этого действия определяется ценой за газ в Эфириуме, и как было упомянуто выше, она очень нестабильна. Именно поэтому оператор может определять новую цену в `ergs` за публикацию данных для каждого блока. Пользователи могут задавать лимит в`ergs_per_pubdata` для транзакций типа [EIP712](https://v2-docs.zksync.io/api/api.html#eip712).

### Что это значит для меня? <a href="#what-does-this-mean-to-me" id="what-does-this-mean-to-me"></a>

Несмотря на различия, комиссионная модель довольно схожа с Эфириумовской; наиболее затратная операция - изменение состояния в хранилище. Одно из преимуществ zkRollup'ов над Optimisic Rollup'ами в том, что вместо публикации всех транзакционных данных zkRollup'ы могут публиковать лишь изменения в состоянии хранилища, таким образом делая меньше изменений в хранилище.

Как уже было упомянуло, если один и тот же слот хранилища обновляется несколько раз в рамках одного блока, то лишь последнее обновление будет опубликовано в Эфириум, а цена за изменение в хранилище будет уплачена лишь единожды; но это правило выходит и за рамки простых слотов в хранилище. Например, DEX и `PairFactory` фактори для различных пулов пар `Pair`. Байт-код контракта `Pair` нужно опубликовать лишь при первом развертывании. После того как код `Pair` был опубликован впервые, следующие развертывания будут включать в себя изменение только в одном слоте хранилища - для установки хэша кода контракта на недавно развернутый адрес пары `Pair`.

Вот некоторые подсказки, как получить максимальную отдачу от системы комиссий zkSync:

* **Обновляйте слоты в хранилище как можно реже.** Стоимость исполнения гораздо ниже, чем стоимость обновлений хранилища.
* **Используйте заново настолько много слотов хранилища, насколько возможно.** Только изменение состояния публикуется в Эфириум.
* **Пользователям лучше разделять как можно больше слотов хранилища.** Если 100 пользователей внесут изменения в слот хранилища вашего контракта, изменение будет опубликовано лишь единожды. В будущем вы введем компенсации для пользователей, чтобы расходы на обновление общих слотов для хранения данных распределись между пользователями пропорционально.
* **По возможности, повторно используйте код контракта.** На Ethereum избегание параметров конструктора и помещение их в константы немного уменьшает стоимость газа при развертывании контракта. На zkSync верно обратное: развертывание одного и того же байт-кода для контрактов при изменении только параметров конструктора может привести к существенной экономии на комиссиях.
