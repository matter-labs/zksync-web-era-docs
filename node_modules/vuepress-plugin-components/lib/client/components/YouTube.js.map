{"version":3,"file":"YouTube.js","sources":["../../../src/client/composables/size.ts","../../../src/client/components/YouTube.ts"],"sourcesContent":["import { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, isRef, ref, unref, watch } from \"vue\";\nimport type { MaybeRef } from \"@vueuse/core\";\nimport type { Ref } from \"vue\";\n\nconst getValue = (value: string | number): string =>\n  typeof value === \"string\" ? value : `${value}px`;\n\nexport interface SizeOptions {\n  width: string | number | undefined;\n  height: string | number | undefined;\n  ratio: string | number | undefined;\n}\n\nexport interface SizeInfo<E extends HTMLElement> {\n  el: Ref<E | undefined>;\n  width: Ref<string>;\n  height: Ref<string>;\n}\n\nexport const useSize = <E extends HTMLElement>(\n  options: SizeOptions,\n  extraHeight: MaybeRef<number> = 0\n): SizeInfo<E> => {\n  const el = ref<E>();\n  const width = computed(() => getValue(unref(options.width) || \"100%\"));\n  const height = ref(\"auto\");\n\n  const getRadio = (radio: number | string | undefined): number => {\n    if (typeof radio === \"string\") {\n      const [width, height] = radio.split(\":\");\n      const parsedRadio = Number(width) / Number(height);\n\n      if (!Number.isNaN(parsedRadio)) return parsedRadio;\n    }\n\n    return typeof radio === \"number\" ? radio : 16 / 9;\n  };\n\n  const getHeight = (width: number): string => {\n    const height = unref(options.height);\n    const ratio = getRadio(unref(options.ratio));\n\n    return height\n      ? getValue(height)\n      : `${Number(width) / ratio + unref(extraHeight)}px`;\n  };\n\n  const updateHeight = (): void => {\n    if (el.value) height.value = getHeight(el.value.clientWidth);\n  };\n\n  onMounted(() => {\n    updateHeight();\n    if (isRef(extraHeight)) watch(extraHeight, () => updateHeight());\n    useEventListener(\"orientationchange\", () => updateHeight());\n    useEventListener(\"resize\", () => updateHeight());\n  });\n\n  return {\n    el,\n    width,\n    height,\n  };\n};\n","/* eslint-disable vue/no-unused-properties */\nimport { usePageLang } from \"@vuepress/client\";\nimport { computed, defineComponent, h } from \"vue\";\n\nimport { useSize } from \"../composables/index.js\";\n\nimport type { VNode } from \"vue\";\n\nimport \"../styles/youtube.scss\";\n\nexport default defineComponent({\n  name: \"YouTube\",\n\n  props: {\n    /**\n     * YouTube video id\n     *\n     * YouTube 视频 id\n     */\n    id: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Youtube video title\n     *\n     * Youtube 视频标题\n     */\n    title: {\n      type: String,\n      default: \"A YouTube video\",\n    },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Component height\n     *\n     * 组件高度\n     */\n    height: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    /**\n     * Component width / height ratio\n     *\n     * 组件长宽比\n     */\n    ratio: {\n      type: [String, Number],\n      default: 16 / 9,\n    },\n\n    /**\n     * Whether to autoplay the video\n     *\n     * 是否自动播放视频\n     */\n    autoplay: Boolean,\n\n    /**\n     * Whether to loop the video\n     *\n     * 是否循环播放视频\n     */\n    loop: Boolean,\n\n    /**\n     * Whether to show cc\n     *\n     * 是否显示字幕\n     */\n    showCc: Boolean,\n\n    /**\n     * Whether to show annotations\n     *\n     * 是否显示注释\n     */\n    showAnnotations: Boolean,\n\n    /**\n     * Video start time in seconds\n     *\n     * 视频开始时间 (秒)\n     */\n    start: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    /**\n     * Video end time in seconds\n     *\n     * 视频结束时间 (秒)\n     */\n    end: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    /**\n     * Default cc lang\n     *\n     * 默认字幕语言\n     */\n    defaultCcLang: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * UI language\n     *\n     * UI 语言\n     */\n    uiLang: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * List type\n     *\n     * 列表类型\n     */\n    listType: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * List\n     *\n     * 列表\n     */\n    list: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Playlist id\n     *\n     * 播放列表 id\n     */\n    playlist: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Whether to disable controls\n     *\n     * 是否禁用控制\n     */\n    disableControls: Boolean,\n\n    /**\n     * Whether to disable fullscreen\n     *\n     * 是否禁用全屏\n     */\n    disableFullscreen: Boolean,\n\n    /**\n     * Whether to disable keyboard\n     *\n     * 是否禁用键盘\n     */\n    disableKeyboard: Boolean,\n  },\n\n  setup(props) {\n    const lang = usePageLang();\n    const { el, width, height } = useSize<HTMLIFrameElement>(props);\n\n    const coreURL = computed(() =>\n      props.id\n        ? `${props.id}?`\n        : props.listType === \"playlist\" && props.list\n        ? `?listType=playlist&list=${\n            props.list.startsWith(\"PL\") ? props.list : `PL${props.list}`\n          }&`\n        : null\n    );\n\n    const params = computed(() => {\n      const params = new URLSearchParams();\n\n      if (props.autoplay) params.set(\"autoplay\", \"1\");\n      if (props.loop) params.set(\"loop\", \"1\");\n      if (props.showCc) params.set(\"cc_load_policy\", \"1\");\n      if (props.showAnnotations) params.set(\"iv_load_policy\", \"3\");\n\n      if (props.start) params.set(\"start\", props.start.toString());\n      if (props.end) params.set(\"end\", props.end.toString());\n\n      params.set(\"hl\", props.uiLang || lang.value);\n      params.set(\"cc_lang_pref\", props.defaultCcLang || lang.value);\n      params.set(\"color\", \"white\");\n\n      if (props.disableControls) params.set(\"controls\", \"0\");\n      if (props.disableFullscreen) params.set(\"fs\", \"0\");\n      if (props.disableKeyboard) params.set(\"disablekb\", \"1\");\n\n      if (props.playlist) params.set(\"playlist\", props.playlist);\n\n      return params.toString();\n    });\n\n    const videoLink = computed(() =>\n      coreURL.value\n        ? `https://www.youtube.com/embed/${coreURL.value}${params.value}`\n        : null\n    );\n\n    return (): VNode[] | null =>\n      videoLink.value\n        ? [\n            h(\n              \"div\",\n              { class: \"youtube-desc\" },\n              h(\"a\", { class: \"sr-only\", href: videoLink.value }, props.title)\n            ),\n            h(\"iframe\", {\n              ref: el,\n              src: videoLink.value,\n              title: props.title,\n              class: \"youtube-iframe\",\n              allow:\n                \"accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; gyroscope; picture-in-picture\",\n              style: {\n                width: width.value,\n                height: height.value,\n              },\n            }),\n          ]\n        : null;\n  },\n});\n"],"names":["getValue","value","useSize","options","extraHeight","el","ref","width","computed","unref","height","getRadio","radio","parsedRadio","getHeight","ratio","updateHeight","onMounted","isRef","watch","useEventListener","YouTube","defineComponent","props","lang","usePageLang","coreURL","params","videoLink","h"],"mappings":"kPAKA,MAAMA,EAAYC,GAChB,OAAOA,GAAU,SAAWA,EAAQ,GAAGA,MAc5BC,EAAU,CACrBC,EACAC,EAAgC,IAChB,CAChB,MAAMC,EAAKC,EAAAA,EACLC,EAAQC,EAAS,IAAMR,EAASS,EAAMN,EAAQ,KAAK,GAAK,MAAM,CAAC,EAC/DO,EAASJ,EAAI,MAAM,EAEnBK,EAAYC,GAA+C,CAC/D,GAAI,OAAOA,GAAU,SAAU,CAC7B,KAAM,CAACL,EAAOG,CAAM,EAAIE,EAAM,MAAM,GAAG,EACjCC,EAAc,OAAON,CAAK,EAAI,OAAOG,CAAM,EAEjD,GAAI,CAAC,OAAO,MAAMG,CAAW,EAAG,OAAOA,CACzC,CAEA,OAAO,OAAOD,GAAU,SAAWA,EAAQ,GAAK,CAClD,EAEME,EAAaP,GAA0B,CAC3C,MAAMG,EAASD,EAAMN,EAAQ,MAAM,EAC7BY,EAAQJ,EAASF,EAAMN,EAAQ,KAAK,CAAC,EAE3C,OAAOO,EACHV,EAASU,CAAM,EACf,GAAG,OAAOH,CAAK,EAAIQ,EAAQN,EAAML,CAAW,KAClD,EAEMY,EAAe,IAAY,CAC3BX,EAAG,QAAOK,EAAO,MAAQI,EAAUT,EAAG,MAAM,WAAW,EAC7D,EAEA,OAAAY,EAAU,IAAM,CACdD,EACIE,EAAAA,EAAMd,CAAW,GAAGe,EAAMf,EAAa,IAAMY,EAAAA,CAAc,EAC/DI,EAAiB,oBAAqB,IAAMJ,EAAc,CAAA,EAC1DI,EAAiB,SAAU,IAAMJ,GAAc,CACjD,CAAC,EAEM,CACL,GAAAX,EACA,MAAAE,EACA,OAAAG,CACF,CACF,ECtDA,IAAAW,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,GAAI,CACF,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,OACN,QAAS,iBACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,OAAQ,CACN,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,GAAK,CAChB,EAOA,SAAU,QAOV,KAAM,QAON,OAAQ,QAOR,gBAAiB,QAOjB,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,IAAK,CACH,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,cAAe,CACb,KAAM,OACN,QAAS,EACX,EAOA,OAAQ,CACN,KAAM,OACN,QAAS,EACX,EAOA,SAAU,CACR,KAAM,OACN,QAAS,EACX,EAOA,KAAM,CACJ,KAAM,OACN,QAAS,EACX,EAOA,SAAU,CACR,KAAM,OACN,QAAS,EACX,EAOA,gBAAiB,QAOjB,kBAAmB,QAOnB,gBAAiB,OACnB,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAOC,IACP,CAAE,GAAApB,EAAI,MAAAE,EAAO,OAAAG,CAAO,EAAIR,EAA2BqB,CAAK,EAExDG,EAAUlB,EAAS,IACvBe,EAAM,GACF,GAAGA,EAAM,MACTA,EAAM,WAAa,YAAcA,EAAM,KACvC,2BACEA,EAAM,KAAK,WAAW,IAAI,EAAIA,EAAM,KAAO,KAAKA,EAAM,UAExD,IACN,EAEMI,EAASnB,EAAS,IAAM,CAC5B,MAAMmB,EAAS,IAAI,gBAEnB,OAAIJ,EAAM,UAAUI,EAAO,IAAI,WAAY,GAAG,EAC1CJ,EAAM,MAAMI,EAAO,IAAI,OAAQ,GAAG,EAClCJ,EAAM,QAAQI,EAAO,IAAI,iBAAkB,GAAG,EAC9CJ,EAAM,iBAAiBI,EAAO,IAAI,iBAAkB,GAAG,EAEvDJ,EAAM,OAAOI,EAAO,IAAI,QAASJ,EAAM,MAAM,SAAU,CAAA,EACvDA,EAAM,KAAKI,EAAO,IAAI,MAAOJ,EAAM,IAAI,UAAU,EAErDI,EAAO,IAAI,KAAMJ,EAAM,QAAUC,EAAK,KAAK,EAC3CG,EAAO,IAAI,eAAgBJ,EAAM,eAAiBC,EAAK,KAAK,EAC5DG,EAAO,IAAI,QAAS,OAAO,EAEvBJ,EAAM,iBAAiBI,EAAO,IAAI,WAAY,GAAG,EACjDJ,EAAM,mBAAmBI,EAAO,IAAI,KAAM,GAAG,EAC7CJ,EAAM,iBAAiBI,EAAO,IAAI,YAAa,GAAG,EAElDJ,EAAM,UAAUI,EAAO,IAAI,WAAYJ,EAAM,QAAQ,EAElDI,EAAO,SAChB,CAAA,CAAC,EAEKC,EAAYpB,EAAS,IACzBkB,EAAQ,MACJ,iCAAiCA,EAAQ,QAAQC,EAAO,QACxD,IACN,EAEA,MAAO,IACLC,EAAU,MACN,CACEC,EACE,MACA,CAAE,MAAO,cAAe,EACxBA,EAAE,IAAK,CAAE,MAAO,UAAW,KAAMD,EAAU,KAAM,EAAGL,EAAM,KAAK,CACjE,EACAM,EAAE,SAAU,CACV,IAAKxB,EACL,IAAKuB,EAAU,MACf,MAAOL,EAAM,MACb,MAAO,iBACP,MACE,uGACF,MAAO,CACL,MAAOhB,EAAM,MACb,OAAQG,EAAO,KACjB,CACF,CAAC,CACH,EACA,IACR,CACF,CAAC"}