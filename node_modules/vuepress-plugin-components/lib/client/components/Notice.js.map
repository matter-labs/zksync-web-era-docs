{"version":3,"file":"Notice.js","sources":["../../../src/client/components/icons.ts","../../../src/client/components/Notice.ts"],"sourcesContent":["import { h } from \"vue\";\nimport { IconBase } from \"vuepress-shared/client\";\n\nimport type { FunctionalComponent } from \"vue\";\n\nexport const BackToTopIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"back-to-top\" }, () => [\n    h(\"path\", {\n      d: \"M512 843.2c-36.2 0-66.4-13.6-85.8-21.8-10.8-4.6-22.6 3.6-21.8 15.2l7 102c.4 6.2 7.6 9.4 12.6 5.6l29-22c3.6-2.8 9-1.8 11.4 2l41 64.2c3 4.8 10.2 4.8 13.2 0l41-64.2c2.4-3.8 7.8-4.8 11.4-2l29 22c5 3.8 12.2.6 12.6-5.6l7-102c.8-11.6-11-20-21.8-15.2-19.6 8.2-49.6 21.8-85.8 21.8z\",\n    }),\n    h(\"path\", {\n      d: \"m795.4 586.2-96-98.2C699.4 172 513 32 513 32S324.8 172 324.8 488l-96 98.2c-3.6 3.6-5.2 9-4.4 14.2L261.2 824c1.8 11.4 14.2 17 23.6 10.8L419 744s41.4 40 94.2 40c52.8 0 92.2-40 92.2-40l134.2 90.8c9.2 6.2 21.6.6 23.6-10.8l37-223.8c.4-5.2-1.2-10.4-4.8-14zM513 384c-34 0-61.4-28.6-61.4-64s27.6-64 61.4-64c34 0 61.4 28.6 61.4 64S547 384 513 384z\",\n    }),\n  ]);\n\nBackToTopIcon.displayName = \"BackToTopIcon\";\n\nexport const CloseIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"close\" }, () =>\n    h(\"path\", {\n      d: \"m925.468 822.294-303.27-310.288L925.51 201.674c34.683-27.842 38.3-75.802 8.122-107.217-30.135-31.37-82.733-34.259-117.408-6.463L512.001 399.257 207.777 87.993C173.1 60.197 120.504 63.087 90.369 94.456c-30.179 31.415-26.561 79.376 8.122 107.217L401.8 512.005l-303.27 310.29c-34.724 27.82-38.34 75.846-8.117 107.194 30.135 31.437 82.729 34.327 117.408 6.486L512 624.756l304.177 311.22c34.68 27.84 87.272 24.95 117.408-6.487 30.223-31.348 26.56-79.375-8.118-107.195z\",\n    })\n  );\n\nCloseIcon.displayName = \"CloseIcon\";\n","import {\n  TransitionGroup,\n  defineComponent,\n  onMounted,\n  h,\n  ref,\n  computed,\n} from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport { CloseIcon } from \"./icons.js\";\n\nimport type { PropType, VNode } from \"vue\";\nimport type { NoticeLocaleOptions } from \"../../shared/index.js\";\n\nimport \"../styles/notice.scss\";\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Notice\",\n\n  props: {\n    /**\n     * Notice locales settings\n     *\n     * 通知的多语言设置\n     */\n    locales: {\n      type: Object as PropType<Record<string, NoticeLocaleOptions>>,\n      required: true,\n    },\n\n    /**\n     * Notice key\n     *\n     * 通知 key\n     */\n    noticeKey: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Whether show notice only showOnce\n     *\n     * 是否仅展示一次通知\n     */\n    showOnce: Boolean,\n\n    /**\n     * Whether the notice shall be confirmed\n     *\n     * 通知是否需要确认\n     */\n    confirm: Boolean,\n\n    /**\n     * Whether display notice fullscreen\n     *\n     * 是否全屏显示通知\n     */\n    fullscreen: Boolean,\n  },\n\n  setup(props) {\n    const locale = useLocaleConfig(props.locales);\n    const router = useRouter();\n\n    const isVisible = ref(false);\n\n    const key = computed(() =>\n      props.noticeKey\n        ? `notice-${props.noticeKey}`\n        : `${props.locales[\"/\"].title}${props.locales[\"/\"].content}`\n    );\n\n    onMounted(() => {\n      const hasBeenClosed = (\n        props.showOnce ? localStorage : sessionStorage\n      ).getItem(key.value);\n\n      isVisible.value = !hasBeenClosed;\n    });\n\n    const close = (): void => {\n      isVisible.value = false;\n      (props.showOnce ? localStorage : sessionStorage).setItem(\n        \"v2-notice\",\n        \"true\"\n      );\n    };\n\n    const openLink = (link?: string): void => {\n      if (link) {\n        if (link.startsWith(\"/\")) void router.push(link);\n        else window.open(link);\n      }\n      close();\n    };\n\n    return (): VNode =>\n      h(TransitionGroup, { name: \"notice-fade\" }, () =>\n        isVisible.value && locale.value\n          ? [\n              props.fullscreen\n                ? h(\"div\", {\n                    key: \"mask\",\n                    class: \"notice-mask\",\n                    onClick: () => {\n                      if (!props.confirm) close();\n                    },\n                  })\n                : null,\n              h(\n                \"div\",\n                {\n                  key: \"popup\",\n                  class: [\"notice-wrapper\", { fullscreen: props.fullscreen }],\n                },\n                [\n                  h(\"header\", { class: \"notice-title\" }, [\n                    h(\"span\", { innerHTML: locale.value.title }),\n                    props.confirm\n                      ? null\n                      : h(CloseIcon, { onClick: (): void => close() }),\n                  ]),\n                  h(\"div\", {\n                    class: \"notice-content\",\n                    innerHTML: locale.value.content,\n                  }),\n                  h(\n                    \"div\",\n                    { class: \"notice-footer\" },\n                    locale.value.actions.map(({ text, link, type = \"\" }) =>\n                      h(\"button\", {\n                        class: [\"notice-footer-action\", type],\n                        onClick: () => openLink(link),\n                        innerHTML: text,\n                      })\n                    )\n                  ),\n                ]\n              ),\n            ]\n          : []\n      );\n  },\n});\n"],"names":["CloseIcon","h","IconBase","defineComponent","props","locale","useLocaleConfig","router","useRouter","isVisible","ref","key","computed","onMounted","hasBeenClosed","close","openLink","link","TransitionGroup","text","type"],"mappings":"oPAiBa,MAAAA,EAAiC,IAC5CC,EAAEC,EAAU,CAAE,KAAM,OAAQ,EAAG,IAC7BD,EAAE,OAAQ,CACR,EAAG,idACL,CAAC,CACH,EAEFD,EAAU,YAAc,YCNxB,IAAeG,EAAAA,EAAgB,CAE7B,KAAM,SAEN,MAAO,CAML,QAAS,CACP,KAAM,OACN,SAAU,EACZ,EAOA,UAAW,CACT,KAAM,OACN,QAAS,EACX,EAOA,SAAU,QAOV,QAAS,QAOT,WAAY,OACd,EAEA,MAAMC,EAAO,CACX,MAAMC,EAASC,EAAgBF,EAAM,OAAO,EACtCG,EAASC,IAETC,EAAYC,EAAI,EAAK,EAErBC,EAAMC,EAAS,IACnBR,EAAM,UACF,UAAUA,EAAM,YAChB,GAAGA,EAAM,QAAQ,KAAK,QAAQA,EAAM,QAAQ,KAAK,SACvD,EAEAS,EAAU,IAAM,CACd,MAAMC,GACJV,EAAM,SAAW,aAAe,gBAChC,QAAQO,EAAI,KAAK,EAEnBF,EAAU,MAAQ,CAACK,CACrB,CAAC,EAED,MAAMC,EAAQ,IAAY,CACxBN,EAAU,MAAQ,IACjBL,EAAM,SAAW,aAAe,gBAAgB,QAC/C,YACA,MACF,CACF,EAEMY,EAAYC,GAAwB,CACpCA,IACEA,EAAK,WAAW,GAAG,EAAQV,EAAO,KAAKU,CAAI,EAC1C,OAAO,KAAKA,CAAI,GAEvBF,EAAM,CACR,EAEA,MAAO,IACLd,EAAEiB,EAAiB,CAAE,KAAM,aAAc,EAAG,IAC1CT,EAAU,OAASJ,EAAO,MACtB,CACED,EAAM,WACFH,EAAE,MAAO,CACP,IAAK,OACL,MAAO,cACP,QAAS,IAAM,CACRG,EAAM,SAASW,EAAAA,CACtB,CACF,CAAC,EACD,KACJd,EACE,MACA,CACE,IAAK,QACL,MAAO,CAAC,iBAAkB,CAAE,WAAYG,EAAM,UAAW,CAAC,CAC5D,EACA,CACEH,EAAE,SAAU,CAAE,MAAO,cAAe,EAAG,CACrCA,EAAE,OAAQ,CAAE,UAAWI,EAAO,MAAM,KAAM,CAAC,EAC3CD,EAAM,QACF,KACAH,EAAED,EAAW,CAAE,QAAS,IAAYe,EAAQ,CAAA,CAAC,CACnD,CAAC,EACDd,EAAE,MAAO,CACP,MAAO,iBACP,UAAWI,EAAO,MAAM,OAC1B,CAAC,EACDJ,EACE,MACA,CAAE,MAAO,eAAgB,EACzBI,EAAO,MAAM,QAAQ,IAAI,CAAC,CAAE,KAAAc,EAAM,KAAAF,EAAM,KAAAG,EAAO,EAAG,IAChDnB,EAAE,SAAU,CACV,MAAO,CAAC,uBAAwBmB,CAAI,EACpC,QAAS,IAAMJ,EAASC,CAAI,EAC5B,UAAWE,CACb,CAAC,CACH,CACF,CACF,CACF,CACF,EACA,CACN,CAAA,CACJ,CACF,CAAC"}