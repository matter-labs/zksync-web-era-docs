# Развертывание контракта

Для обеспечения той же безопасности, что и на L1, оператор zkSync должен публиковать в сети код контракта для каждого контракта, который он развертывает. Однако, если существует несколько контрактов, развернутых с одним и тем же кодом, его достаточно опубликовать только один раз.

Хотя развертывание контракта в первый раз может быть довольно дорогостоящим действием, "фабрики" (factories), которые размещают контракты с одним и тем же кодом несколько раз, могут экономить приличные суммы по сравнению с L1.

Все эти особенности делают процесс развертывания смарт-контрактов на zkEVM соответствующим главному правилу: _Оператор должен знать код контракта до его развертывания_. Это означает, что развертывание контрактов возможно только с помощью транзакций типа `EIP712` с полем `factory_deps`, содержащим предоставленный байт-код. Подробнее о транзакциях EIP712 [здесь](https://v2-docs.zksync.io/api/api.html#eip712).

Итого:

* **Как развертывание контрактов работает на Эфириуме.** Для развертывания контракта пользователь отправляет транзакцию на нулевой адрес (`0x000...000`) с заполненным полем `data`, которое будет эквивалентно байт-коду контракта, согласованного с параметрами конструктора.&#x20;
* **Как это работает zkSync.** Пользователь вызывает функцию `create` контракта [ContractDeployer](https://v2-docs.zksync.io/dev/zksync-v2/system-contracts.html#contractdeployer) и предоставляет хэш развертываемого контракта вместе с аргументами конструктора. Сам же байт-код контракта предоставляется в поле `factory_deps` транзакции типа EIP712. Если контракт является фабрикой (т.е. может развертывать другие контракты), то байт-коды эти контрактов тоже должны быть включены в `factory_deps.`

Весь процесс развертывания проводится внутри нашего плагина [hardhat](https://v2-docs.zksync.io/api/hardhat).

### Различия в поведении `CREATE` <a href="#differences-in-create-behaviour" id="differences-in-create-behaviour"></a>

Для облегчения поддержки абстракции аккаунта, для каждого аккаунта мы делим nonce на две части: _deployment nonce_ & _transaction nonce._ Deployment nonce - это число контрактов, развернутых аккаунтов с помощью опкода `CREATE,` тогда как transaction nonce используется защиты транзакций от атак повторного воспроизведения.

Это означает, что в то время как для смарт-контрактов nonce на zkSync ведет себя так же, как и на Ethereum, для EOA-аккаунта вычисление адреса развернутого контракта не так просто. На Ethereum его можно смело рассчитать как `hash(RLP[address,nonce])`, а на zkSync рекомендуется подождать, пока не будет развернут контракт, и поймать событие с адресом нового развернутого контракта. Все это делается в фоновом режиме с помощью SDK.&#x20;

Чтобы получить детерминированный адрес, вам нужно использовать `create2`. Он доступен и для EOA-аккаунтов, но пока не доступен в SDK.
